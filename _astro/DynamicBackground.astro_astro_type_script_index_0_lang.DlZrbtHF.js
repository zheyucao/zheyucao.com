import{A as T}from"./animationConstants.C5dRCtVd.js";function D(i){return{numBlobs:i?3:4,baseLargeMinBlobSize:1e3,baseLargeMaxBlobSize:1600,baseSmallMinBlobSize:600,baseSmallMaxBlobSize:1e3,referenceWidth:1440,minScaleFactor:.5,maxScaleFactor:1.5,speedMultiplier:i?.5:1,mouseInfluenceRadius:580,mouseForce:-800,opacity:.8,enableShapeChanging:!1,enableCollisionDetection:!0,enableMouseInteraction:!0}}function f(i,t){return Math.random()*(t-i)+i}function C(i){for(let t=i.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[i[t],i[e]]=[i[e],i[t]]}return i}function L(i){if(i=i.replace(/^#/,""),i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),i.length!==6)return null;const t=parseInt(i.substring(0,2),16)/255,e=parseInt(i.substring(2,4),16)/255,o=parseInt(i.substring(4,6),16)/255,s=Math.max(t,e,o),a=Math.min(t,e,o);let n=0,c=0;const h=(s+a)/2;if(s!==a){const r=s-a;switch(c=h>.5?r/(2-s-a):r/(s+a),s){case t:n=(e-o)/r+(e<o?6:0);break;case e:n=(o-t)/r+2;break;case o:n=(t-e)/r+4;break}n/=6}return{h:Math.round(n*360),s:Math.round(c*100),l:Math.round(h*100)}}const F={reds:["#FF6B6B","#FFD93D","#F2bF47","#F2B707","#F28706","#F26430"],oranges:["#FFa700","#FF9B58","#F27149","#F9c443","#faD93D"],yellows:["#FFD700","#FFDB58","#F2E109","#F9D423","#caD93D"],greens:["#90EE90","#6BCB77","#3CB371","#32CD32","#a0e9c4"],cyans:["#40E0D0","#AFEEEE","#7FFFD4","#B3E0F2","#9EfDF2"],blues:["#87CEEB","#64f5ED","#7De6FF","#42d5FF","#7299f9"],forest:["#64f5ED","#F2E109","#32CD32","#32CD32","#a0e9c4"],purples:["#996BcB","#c2aFF7","#8267d7","#FF55ff","#e264d0"],browns:["#8B4513","#A0522D","#D2691E","#DAA520","#8B3030"],winter:["#87CEEB","#64f5ED","#7De6FF","#cccccc","#ffffff"]};function I(i){const t=Object.keys(F),e=t[Math.floor(Math.random()*t.length)],o=F[e]||[],s=C([...o]);return Array.from({length:i},(a,n)=>s[n%s.length]||"#90EE90")}function A(i,t,e,o,s,a){const n=[],c=[],h=[],r=Math.PI*2/a;for(let l=0;l<a;l++){const d=l*r;c.push(d);let u=e+f(-.3,o)*e;u+=f(0,s)*e,u=Math.max(e*.2,u),h.push(u),n.push({x:i+Math.cos(d)*u,y:t+Math.sin(d)*u})}return{points:n,angles:c,radii:h}}function R(i){const t=new Path2D;if(i.length<3)return t;t.moveTo(i[0].x,i[0].y);const e=i.length;for(let o=0;o<e;o++){const s=i[(o-1+e)%e],a=i[o],n=i[(o+1)%e],c=i[(o+2)%e],h=a.x+(n.x-s.x)/6,r=a.y+(n.y-s.y)/6,l=n.x-(c.x-a.x)/6,d=n.y-(c.y-a.y)/6;t.bezierCurveTo(h,r,l,d,n.x,n.y)}return t.closePath(),t}class z{container;canvas;ctx;blobs=[];rafId=null;mouseThrottleTimeout=null;mousePos=null;targetOffset={x:0,y:0};currentOffset={x:0,y:0};cachedContainerRect={width:0,height:0,left:0,top:0};needsRectUpdate=!0;isMobileDevice;config;fpsHistory=[];lastTimestamp=0;lastLogicExecutionTime=0;observer=null;isVisible=!0;prefersReducedMotion=!1;cleanupListeners=()=>{};forceStaticMode=!1;dpr=1;constructor(t,e){const o=document.getElementById(t),s=document.getElementById(e);if(!o||!s)throw new Error("DynamicBackground elements not found");const a=s.getContext("2d");if(!a)throw new Error("Canvas 2D context not available");this.container=o,this.canvas=s,this.ctx=a,this.isMobileDevice="maxTouchPoints"in navigator&&navigator.maxTouchPoints>0||window.innerWidth<1024,this.config=D(this.isMobileDevice),this.forceStaticMode=this.detectFirefox(),this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.init()}init(){this.ensureCanvasSize(),this.prefersReducedMotion||this.forceStaticMode?(this.initStatic(),this.setupEventListeners(!0)):(this.canvas.classList.add("css-hue-shift-active"),this.initBlobs(),this.setupEventListeners(),this.setupIntersectionObserver(),this.startAnimation()),requestAnimationFrame(()=>{this.container.classList.add("is-ready")})}initStatic(){this.config.numBlobs=3,this.config.enableMouseInteraction=!1,this.initBlobs(),this.drawFrame()}cleanup(){this.container.classList.remove("is-ready"),this.canvas.classList.remove("css-hue-shift-active"),this.stopAnimation(),this.mouseThrottleTimeout&&cancelAnimationFrame(this.mouseThrottleTimeout),this.cleanupListeners(),this.observer&&this.observer.disconnect(),this.blobs=[],this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}setupIntersectionObserver(){this.observer=new IntersectionObserver(t=>{t.forEach(e=>{this.isVisible=e.isIntersecting,this.isVisible?this.rafId||this.startAnimation():this.stopAnimation()})},{threshold:0}),this.observer.observe(this.container)}startAnimation(){!this.rafId&&this.isVisible&&!this.prefersReducedMotion&&!this.forceStaticMode&&(this.lastTimestamp=performance.now(),this.lastLogicExecutionTime=performance.now(),this.rafId=requestAnimationFrame(this.animate.bind(this)))}stopAnimation(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}ensureCanvasSize(){if(!this.needsRectUpdate)return;const t=this.container.getBoundingClientRect();this.cachedContainerRect={width:t.width,height:t.height,left:t.left,top:t.top},this.dpr=window.devicePixelRatio||1,this.canvas.width=Math.max(1,Math.floor(t.width*this.dpr)),this.canvas.height=Math.max(1,Math.floor(t.height*this.dpr)),this.canvas.style.width=`${t.width}px`,this.canvas.style.height=`${t.height}px`,this.needsRectUpdate=!1}animate(t){this.rafId=requestAnimationFrame(this.animate.bind(this));const{FPS:e}=T,o=1e3/e.TARGET,s=t-this.lastLogicExecutionTime;if(s<o)return;this.lastLogicExecutionTime=t-s%o;const a=t-this.lastTimestamp;if(this.lastTimestamp=t,!this.isMobileDevice&&a>0){const n=1e3/a;this.fpsHistory.push(n),this.fpsHistory.length>e.HISTORY_LENGTH&&this.fpsHistory.shift()}try{this.ensureCanvasSize();const n=this.cachedContainerRect.width,c=this.cachedContainerRect.height,h=.05;this.currentOffset.x+=(this.targetOffset.x-this.currentOffset.x)*h,this.currentOffset.y+=(this.targetOffset.y-this.currentOffset.y)*h,this.blobs.forEach(r=>this.updateBlob(r,n,c)),this.drawFrame()}catch(n){console.error("Error in animation loop:",n),this.stopAnimation()}}drawFrame(){this.ensureCanvasSize();const t=this.ctx;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.setTransform(this.dpr,0,0,this.dpr,0,0),t.translate(this.currentOffset.x,this.currentOffset.y),t.globalAlpha=this.config.opacity;for(const e of this.blobs)t.save(),t.translate(e.position.x,e.position.y),t.rotate(e.angle*Math.PI/180),t.fillStyle=e.color,t.fill(e.path),t.restore();t.globalAlpha=1,t.setTransform(1,0,0,1,0,0)}updateBlob(t,e,o){if(t.deformationTime+=1,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angle+=t.angularVelocity,this.config.enableMouseInteraction&&this.mousePos){const c=t.position.x-this.mousePos.x,h=t.position.y-this.mousePos.y,r=c*c+h*h,l=this.config.mouseInfluenceRadius+t.radius*1.2;if(r<l*l){const d=Math.sqrt(r);if(l>.1){const u=Math.pow((l-d)/l,1.5),m=Math.atan2(h,c);t.velocity.x+=Math.cos(m)*u*this.config.mouseForce*this.config.speedMultiplier,t.velocity.y+=Math.sin(m)*u*this.config.mouseForce*this.config.speedMultiplier}}}const s=Math.sqrt(t.velocity.x**2+t.velocity.y**2),a=1.5*this.config.speedMultiplier;if(s>a&&(t.velocity.x*=a/s,t.velocity.y*=a/s),t.velocity.x*=.99,t.velocity.y*=.99,this.config.enableCollisionDetection)for(const h of this.blobs){if(t.id===h.id)continue;const r=h.position.x-t.position.x,l=h.position.y-t.position.y,d=r*r+l*l,u=(t.radius+h.radius)*.5,m=u*u;if(d<m&&d>0){const y=Math.sqrt(d),g=u-y,v=Math.atan2(l,r),M=Math.cos(v)*g*.01,E=Math.sin(v)*g*.01;t.velocity.x-=M,t.velocity.y-=E}}const n=.05*this.config.speedMultiplier;t.position.x<t.radius&&(t.velocity.x+=n),t.position.x>e-t.radius&&(t.velocity.x-=n),t.position.y<t.radius&&(t.velocity.y+=n),t.position.y>o-t.radius&&(t.velocity.y-=n),t.position.x=Math.max(t.radius/2,Math.min(e-t.radius/2,t.position.x)),t.position.y=Math.max(t.radius/2,Math.min(o-t.radius/2,t.position.y))}initBlobs(){this.blobs=[],this.needsRectUpdate=!0,this.ensureCanvasSize();const{width:t,height:e}=this.cachedContainerRect,o=window.innerWidth,s=Math.max(this.config.minScaleFactor,Math.min(this.config.maxScaleFactor,o/this.config.referenceWidth)),a=this.config.baseLargeMinBlobSize*s,n=this.config.baseLargeMaxBlobSize*s,c=this.config.baseSmallMinBlobSize*s,h=this.config.baseSmallMaxBlobSize*s,r=I(this.config.numBlobs),l=Math.ceil(this.config.numBlobs/2);for(let d=0;d<l;d++)this.createSingleBlob(d,a,n,r[d],t,e);for(let d=l;d<this.config.numBlobs;d++)this.createSingleBlob(d,c,h,r[d%r.length],t,e)}createSingleBlob(t,e,o,s,a,n){const c=f(e/2,o/2),h=Math.max(a,c*2),r=Math.max(n,c*2),l={x:f(c,h-c),y:f(c,r-c)},d=L(s),u=A(0,0,c,.3,.2,8),m=R(u.points),y={x:f(-1,1)*this.config.speedMultiplier,y:f(-1,1)*this.config.speedMultiplier},g=f(0,360),v=f(-.15,.15),M={id:t,position:l,velocity:y,radius:c,color:s,hsl:d||{h:0,s:0,l:50},points:u.points,path:m,angle:g,angularVelocity:v,baseAngles:u.angles,baseRadii:u.radii,deformationTime:0,deformationSpeed:f(.005,.015),deformationAmplitude:c*f(.05,.15)};this.blobs.push(M)}setupEventListeners(t=!1){const e=()=>{this.needsRectUpdate=!0,(t||!this.rafId&&(this.prefersReducedMotion||this.forceStaticMode))&&this.drawFrame()};window.addEventListener("resize",e);let o=null,s=null;this.config.enableMouseInteraction&&!t&&(o=a=>{this.mouseThrottleTimeout&&cancelAnimationFrame(this.mouseThrottleTimeout),this.mouseThrottleTimeout=requestAnimationFrame(()=>{try{this.ensureCanvasSize();const n=a.clientX,c=a.clientY;this.mousePos={x:n-this.cachedContainerRect.left,y:c-this.cachedContainerRect.top};const h=window.innerWidth/2,r=window.innerHeight/2,l=-.03;this.targetOffset.x=(n-h)*l,this.targetOffset.y=(c-r)*l}catch(n){console.error("Error in mousemove handler:",n)}})},window.addEventListener("mousemove",o),s=()=>{this.mousePos=null,this.targetOffset.x=0,this.targetOffset.y=0},window.addEventListener("mouseleave",s)),this.cleanupListeners=()=>{window.removeEventListener("resize",e),o&&window.removeEventListener("mousemove",o),s&&window.removeEventListener("mouseleave",s)}}detectFirefox(){const t=navigator.userAgent;return/Firefox|FxiOS/i.test(t)}}let p=null;const w="startViewTransition"in document;function O(){if(!document.getElementById("dynamic-background-container")){x();return}if(!w&&p&&x(),!p)try{p=new z("dynamic-background-container","dynamic-background-canvas")}catch(t){console.error("Failed to initialize DynamicBackground:",t)}}function x(){p&&(p.cleanup(),p=null)}const S=()=>O(),B=()=>{w||x(),document.removeEventListener("astro:page-load",S),document.removeEventListener("astro:before-swap",B)};document.addEventListener("astro:page-load",S);document.addEventListener("astro:before-swap",B);
