import{A as B}from"./animationConstants.C5dRCtVd.js";const y="http://www.w3.org/2000/svg",v={reds:["#FF6B6B","#FFD93D","#F2bF47","#F2B707","#F28706","#F26430"],oranges:["#FFa700","#FF9B58","#F27149","#F9c443","#faD93D"],yellows:["#FFD700","#FFDB58","#F2E109","#F9D423","#caD93D"],greens:["#90EE90","#6BCB77","#3CB371","#32CD32","#a0e9c4"],cyans:["#40E0D0","#AFEEEE","#7FFFD4","#B3E0F2","#9EfDF2"],blues:["#87CEEB","#64f5ED","#7De6FF","#42d5FF","#7299f9"],forest:["#64f5ED","#F2E109","#32CD32","#32CD32","#a0e9c4"],purples:["#996BcB","#c2aFF7","#8267d7","#FF55ff","#e264d0"],browns:["#8B4513","#A0522D","#D2691E","#DAA520","#8B3030"],winter:["#87CEEB","#64f5ED","#7De6FF","#cccccc","#ffffff"]};class E{container;svgContainer;svgGroup=null;blobs=[];rafId=null;mouseThrottleTimeout=null;mousePos=null;targetOffset={x:0,y:0};currentOffset={x:0,y:0};cachedContainerRect={width:0,height:0,left:0,top:0};needsRectUpdate=!0;isMobileDevice;config;fpsHistory=[];lastTimestamp=0;lastLogicExecutionTime=0;observer=null;isVisible=!0;prefersReducedMotion=!1;cleanupListeners=()=>{};constructor(t,i){const s=document.getElementById(t),e=document.getElementById(i);if(!s||!e)throw new Error("DynamicBackground elements not found");this.container=s,this.svgContainer=e,this.isMobileDevice="maxTouchPoints"in navigator&&navigator.maxTouchPoints>0||window.innerWidth<1024,this.config={numBlobs:this.isMobileDevice?3:4,baseLargeMinBlobSize:1e3,baseLargeMaxBlobSize:1600,baseSmallMinBlobSize:600,baseSmallMaxBlobSize:1e3,referenceWidth:1440,minScaleFactor:.5,maxScaleFactor:1.5,speedMultiplier:this.isMobileDevice?.5:1,mouseInfluenceRadius:580,mouseForce:-800,opacity:.8,enableShapeChanging:!1,enableCollisionDetection:!0,enableMouseInteraction:!0},this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.init()}init(){this.prefersReducedMotion?this.initStatic():(this.svgContainer.classList.add("css-hue-shift-active"),this.initBlobs(),this.setupEventListeners(),this.setupIntersectionObserver(),this.startAnimation()),requestAnimationFrame(()=>{this.container.classList.add("is-ready")})}initStatic(){this.config.numBlobs=3,this.initBlobs()}cleanup(){this.container.classList.remove("is-ready"),this.svgContainer.classList.remove("css-hue-shift-active"),this.stopAnimation(),this.mouseThrottleTimeout&&cancelAnimationFrame(this.mouseThrottleTimeout),this.cleanupListeners(),this.observer&&this.observer.disconnect(),this.blobs=[]}setupIntersectionObserver(){this.observer=new IntersectionObserver(t=>{t.forEach(i=>{this.isVisible=i.isIntersecting,this.isVisible?this.rafId||this.startAnimation():this.stopAnimation()})},{threshold:0}),this.observer.observe(this.container)}startAnimation(){!this.rafId&&this.isVisible&&!this.prefersReducedMotion&&(this.lastTimestamp=performance.now(),this.lastLogicExecutionTime=performance.now(),this.rafId=requestAnimationFrame(this.animate.bind(this)))}stopAnimation(){this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null)}updateCachedRect(){if(this.needsRectUpdate){const t=this.svgContainer.getBoundingClientRect();this.cachedContainerRect={width:t.width,height:t.height,left:t.left,top:t.top},this.needsRectUpdate=!1}}animate(t){this.rafId=requestAnimationFrame(this.animate.bind(this));const{FPS:i}=B,s=1e3/i.TARGET,e=t-this.lastLogicExecutionTime;if(e<s)return;this.lastLogicExecutionTime=t-e%s;const r=t-this.lastTimestamp;if(this.lastTimestamp=t,!this.isMobileDevice&&r>0){const o=1e3/r;this.fpsHistory.push(o),this.fpsHistory.length>i.HISTORY_LENGTH&&this.fpsHistory.shift()}try{this.updateCachedRect();const o=this.cachedContainerRect.width,n=this.cachedContainerRect.height;this.svgGroup&&(this.currentOffset.x+=(this.targetOffset.x-this.currentOffset.x)*.05,this.currentOffset.y+=(this.targetOffset.y-this.currentOffset.y)*.05,this.svgGroup.setAttribute("transform",`translate(${this.currentOffset.x}, ${this.currentOffset.y})`)),this.blobs.forEach(a=>this.updateBlob(a,o,n))}catch(o){console.error("Error in animation loop:",o),this.stopAnimation()}}updateBlob(t,i,s){if(t.deformationTime+=1,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angle+=t.angularVelocity,this.config.enableMouseInteraction&&this.mousePos){const n=t.position.x-this.mousePos.x,a=t.position.y-this.mousePos.y,h=n*n+a*a,c=this.config.mouseInfluenceRadius+t.radius*1.2;if(h<c*c){const f=Math.sqrt(h);if(c>.1){const d=Math.pow((c-f)/c,1.5),u=Math.atan2(a,n);t.velocity.x+=Math.cos(u)*d*this.config.mouseForce*this.config.speedMultiplier,t.velocity.y+=Math.sin(u)*d*this.config.mouseForce*this.config.speedMultiplier}}}const e=Math.sqrt(t.velocity.x**2+t.velocity.y**2),r=1.5*this.config.speedMultiplier;if(e>r&&(t.velocity.x*=r/e,t.velocity.y*=r/e),t.velocity.x*=.99,t.velocity.y*=.99,this.config.enableCollisionDetection)for(const a of this.blobs){if(t.id===a.id)continue;const h=a.position.x-t.position.x,c=a.position.y-t.position.y,f=h*h+c*c,d=(t.radius+a.radius)*.5,u=d*d;if(f<u&&f>0){const m=Math.sqrt(f),l=d-m,p=Math.atan2(c,h),F=Math.cos(p)*l*.01,x=Math.sin(p)*l*.01;t.velocity.x-=F,t.velocity.y-=x}}const o=.05*this.config.speedMultiplier;t.position.x<t.radius&&(t.velocity.x+=o),t.position.x>i-t.radius&&(t.velocity.x-=o),t.position.y<t.radius&&(t.velocity.y+=o),t.position.y>s-t.radius&&(t.velocity.y-=o),t.position.x=Math.max(t.radius/2,Math.min(i-t.radius/2,t.position.x)),t.position.y=Math.max(t.radius/2,Math.min(s-t.radius/2,t.position.y)),t.pathElement.setAttribute("transform",`translate(${t.position.x}, ${t.position.y}) rotate(${t.angle})`)}initBlobs(){this.blobs=[],this.svgContainer.innerHTML="",this.svgGroup=document.createElementNS(y,"g"),this.svgContainer.appendChild(this.svgGroup);const{width:t,height:i}=this.svgContainer.getBoundingClientRect(),s=window.innerWidth,e=Math.max(this.config.minScaleFactor,Math.min(this.config.maxScaleFactor,s/this.config.referenceWidth)),r=this.config.baseLargeMinBlobSize*e,o=this.config.baseLargeMaxBlobSize*e,n=this.config.baseSmallMinBlobSize*e,a=this.config.baseSmallMaxBlobSize*e,h=[],c=Object.keys(v),f=c[Math.floor(Math.random()*c.length)],d=v[f]||[],u=this.shuffleArray([...d]);for(let l=0;l<this.config.numBlobs;l++)h.push(u[l%u.length]||"#90EE90");const m=Math.ceil(this.config.numBlobs/2);for(let l=0;l<m;l++)this.createSingleBlob(l,r,o,h[l],t,i);for(let l=m;l<this.config.numBlobs;l++)this.createSingleBlob(l,n,a,h[l%h.length],t,i)}createSingleBlob(t,i,s,e,r,o){const n=this.random(i/2,s/2),a={x:this.random(n,r-n),y:this.random(n,o-n)},h=this.hexToHsl(e),c=this.createBlobPoints(0,0,n,.3,.2,8),f=this.createPathString(c.points),d={x:this.random(-1,1)*this.config.speedMultiplier,y:this.random(-1,1)*this.config.speedMultiplier},u=this.random(0,360),m=this.random(-.15,.15),l=document.createElementNS(y,"path");l.setAttribute("d",f),l.setAttribute("fill",e),l.setAttribute("transform",`translate(${a.x}, ${a.y}) rotate(${u})`),l.style.opacity=String(this.config.opacity),this.svgGroup.appendChild(l);const p={id:t,pathElement:l,position:a,velocity:d,radius:n,color:e,hsl:h||{h:0,s:0,l:50},points:c.points,angle:u,angularVelocity:m,baseAngles:c.angles,baseRadii:c.radii,deformationTime:0,deformationSpeed:this.random(.005,.015),deformationAmplitude:n*this.random(.05,.15)};this.blobs.push(p)}random(t,i){return Math.random()*(i-t)+t}shuffleArray(t){for(let i=t.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]]}return t}hexToHsl(t){if(t=t.replace(/^#/,""),t.length===3&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),t.length!==6)return null;const i=parseInt(t.substring(0,2),16)/255,s=parseInt(t.substring(2,4),16)/255,e=parseInt(t.substring(4,6),16)/255,r=Math.max(i,s,e),o=Math.min(i,s,e);let n=0,a=0;const h=(r+o)/2;if(r!==o){const c=r-o;switch(a=h>.5?c/(2-r-o):c/(r+o),r){case i:n=(s-e)/c+(s<e?6:0);break;case s:n=(e-i)/c+2;break;case e:n=(i-s)/c+4;break}n/=6}return{h:Math.round(n*360),s:Math.round(a*100),l:Math.round(h*100)}}createBlobPoints(t,i,s,e,r,o){const n=[],a=[],h=[],c=Math.PI*2/o;for(let f=0;f<o;f++){const d=f*c;a.push(d);let u=s+this.random(-e,e)*s;u+=this.random(0,r)*s,u=Math.max(s*.2,u),h.push(u),n.push({x:t+Math.cos(d)*u,y:i+Math.sin(d)*u})}return{points:n,angles:a,radii:h}}createPathString(t){if(t.length<3)return"";let i=`M ${t[0].x} ${t[0].y}`;const s=t.length;for(let e=0;e<s;e++){const r=t[(e-1+s)%s],o=t[e],n=t[(e+1)%s],a=t[(e+2)%s],h=o.x+(n.x-r.x)/6,c=o.y+(n.y-r.y)/6,f=n.x-(a.x-o.x)/6,d=n.y-(a.y-o.y)/6;i+=` C ${h} ${c}, ${f} ${d}, ${n.x} ${n.y}`}return i+=" Z",i}setupEventListeners(){const t=()=>{this.needsRectUpdate=!0};window.addEventListener("resize",t);const i=e=>{this.config.enableMouseInteraction&&(this.mouseThrottleTimeout&&cancelAnimationFrame(this.mouseThrottleTimeout),this.mouseThrottleTimeout=requestAnimationFrame(()=>{try{this.updateCachedRect();const r=e.clientX,o=e.clientY;this.mousePos={x:r-this.cachedContainerRect.left,y:o-this.cachedContainerRect.top};const n=window.innerWidth/2,a=window.innerHeight/2,h=-.03;this.targetOffset.x=(r-n)*h,this.targetOffset.y=(o-a)*h}catch(r){console.error("Error in mousemove handler:",r)}}))};window.addEventListener("mousemove",i);const s=()=>{this.mousePos=null,this.targetOffset.x=0,this.targetOffset.y=0};window.addEventListener("mouseleave",s),this.cleanupListeners=()=>{window.removeEventListener("resize",t),window.removeEventListener("mousemove",i),window.removeEventListener("mouseleave",s)}}}let g=null;function S(){if(!document.getElementById("dynamic-background-container")){w();return}if(!g)try{g=new E("dynamic-background-container","dynamic-background-svg")}catch(t){console.error("Failed to initialize DynamicBackground:",t)}}function w(){g&&(g.cleanup(),g=null)}document.addEventListener("astro:page-load",S);
