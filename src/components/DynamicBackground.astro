---

---

<div id="dynamic-background-container">
  <canvas id="dynamic-background-canvas"></canvas>
</div>

<script>
  import { DynamicBackgroundManager } from "../lib/components/DynamicBackground";

  let backgroundManager: DynamicBackgroundManager | null = null;

  function initBackground() {
    const container = document.getElementById("dynamic-background-container");

    if (!container) {
      // Container is gone (navigated to a page without background), cleanup
      cleanupBackground();
      return;
    }

    if (backgroundManager) return; // Prevent double init if already running

    try {
      backgroundManager = new DynamicBackgroundManager(
        "dynamic-background-container",
        "dynamic-background-canvas"
      );
    } catch (e) {
      console.error("Failed to initialize DynamicBackground:", e);
    }
  }

  function cleanupBackground() {
    if (backgroundManager) {
      backgroundManager.cleanup();
      backgroundManager = null;
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initBackground, { once: true });
  } else {
    initBackground();
  }
  window.addEventListener("pagehide", cleanupBackground);
</script>

<style>
  #dynamic-background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    filter: blur(30px);
    opacity: var(--dynamic-bg-opacity);
    view-transition-name: dynamic-background;
  }

  /* Medium screens (e.g., tablets) */
  @media (min-width: 768px) {
    #dynamic-background-container {
      filter: blur(50px);
    }
  }

  /* Large screens (e.g., desktops) */
  @media (min-width: 1024px) {
    #dynamic-background-container {
      filter: blur(80px);
    }
  }

  #dynamic-background-canvas {
    display: block; /* Prevents extra space below canvas */
    width: 100%;
    height: 100%;
  }

  @keyframes hue-rotate-anim {
    from {
      filter: hue-rotate(0deg);
    }
    to {
      filter: hue-rotate(360deg);
    }
  }

  #dynamic-background-canvas.css-hue-shift-active {
    animation: hue-rotate-anim 50s linear infinite;
  }
</style>
