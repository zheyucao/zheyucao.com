---

---

<div id="dynamic-background-container" transition:persist={true}>
  <svg id="dynamic-background-svg" width="100%" height="100%"></svg>
</div>

<script>
  import { DynamicBackgroundManager } from "../lib/components/DynamicBackground";

  let backgroundManager: DynamicBackgroundManager | null = null;

  function initBackground() {
    if (backgroundManager) return; // Prevent double init
    try {
      backgroundManager = new DynamicBackgroundManager(
        "dynamic-background-container",
        "dynamic-background-svg"
      );
    } catch (e) {
      console.error("Failed to initialize DynamicBackground:", e);
    }
  }

  function cleanupBackground() {
    if (backgroundManager) {
      backgroundManager.cleanup();
      backgroundManager = null;
    }
  }

  // Initialize on page load
  document.addEventListener("astro:page-load", initBackground);

  // Cleanup before navigation
  document.addEventListener("astro:before-swap", cleanupBackground);
</script>

<style>
  #dynamic-background-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    filter: blur(30px);
    opacity: var(--dynamic-bg-opacity);
    transition: filter 0.3s ease;
  }

  /* Medium screens (e.g., tablets) */
  @media (min-width: 768px) {
    #dynamic-background-container {
      filter: blur(50px);
    }
  }

  /* Large screens (e.g., desktops) */
  @media (min-width: 1024px) {
    #dynamic-background-container {
      filter: blur(80px);
    }
  }

  #dynamic-background-svg {
    display: block; /* Prevents extra space below SVG */
  }

  @keyframes hue-rotate-anim {
    from {
      filter: hue-rotate(0deg);
    }
    to {
      filter: hue-rotate(360deg);
    }
  }

  #dynamic-background-svg.css-hue-shift-active {
    animation: hue-rotate-anim 50s linear infinite;
  }
</style>
