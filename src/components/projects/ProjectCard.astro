---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  id?: string;
  title: string;
  imageSrc?: ImageMetadata;
  imageAlt?: string;
  date?: string;
  projectUrl?: string;
  githubUrl?: string;
  githubRepos?: { title?: string; url: string }[];
  techStack?: string[];
}

const {
  id,
  title,
  imageSrc,
  imageAlt = "Project thumbnail", // Default alt text
  date,
  projectUrl,
  githubUrl,
  githubRepos,
  techStack = [],
} = Astro.props;
---

<article id={id} class="project-card scroll-reveal-animate rounded-lg border border-card-border overflow-hidden flex flex-col mb-12">
  {
    imageSrc && (
      <div class="aspect-[16/9] overflow-hidden bg-[var(--bg-muted)]">
        <Image src={imageSrc} alt={imageAlt} class="w-full h-full object-cover object-top block" />
      </div>
    )
  }
  <div class="p-8 flex flex-col">
    <header class="mb-4">
      <h3 class="text-[1.5rem] font-normal m-0 text-[var(--heading-color)] leading-[1.3]">{title}</h3>
    </header>

    <div class="mb-4 flex flex-col gap-[0.8rem] font-sans">
      {date && <span class="text-[0.9rem] text-text-muted block">{date}</span>}
      {
        techStack.length > 0 && (
          <div class="flex flex-wrap gap-[0.4rem] leading-[1.4] pt-[0.2em]">
            {techStack.map((tech) => (
              <span class="bg-[var(--tag-bg-color)] text-[var(--tag-text-color)] text-[0.85rem] rounded">{tech}</span>
            ))}
          </div>
        )
      }
      <div class="project-links flex flex-wrap gap-[1.2rem] items-center">
        {
          githubRepos && githubRepos.length > 0 ? (
            githubRepos.map((repo) => (
              <a
                href={repo.url}
                target="_blank"
                rel="noopener noreferrer"
                title={`View ${repo.title || "source"} on GitHub`}
                class="text-[var(--link-color)] no-underline text-[0.9rem] inline-flex items-center gap-[0.4em] hover:text-[var(--link-hover-color)] hover:underline"
              >
                <Icon name="ri:github-line" /> {repo.title || "GitHub"}
              </a>
            ))
          ) : githubUrl ? (
            <a
              href={githubUrl}
              target="_blank"
              rel="noopener noreferrer"
              title="View source on GitHub"
              class="text-[var(--link-color)] no-underline text-[0.9rem] inline-flex items-center gap-[0.4em] hover:text-[var(--link-hover-color)] hover:underline"
            >
              <Icon name="ri:github-line" /> GitHub
            </a>
          ) : null
        }
        {
          projectUrl && (
            <a
              href={projectUrl}
              target="_blank"
              rel="noopener noreferrer"
              title="Visit live site"
              class="text-[var(--link-color)] no-underline text-[0.9rem] inline-flex items-center gap-[0.4em] hover:text-[var(--link-hover-color)] hover:underline"
            >
              <Icon name="ri:external-link-line" /> Live Site
            </a>
          )
        }
      </div>
    </div>

    <div class="project-body text-[1.2rem] leading-[1.8]">
      <slot />
    </div>
  </div>
</article>

<style>
  /* Animation states - kept in CSS */
  .project-card {
    opacity: 0;
    filter: blur(5px);
    transform: translateY(20px) translateZ(0);
    will-change: auto;
    transition:
      opacity 0.8s ease-out,
      filter 0.8s ease-out,
      transform 0.8s ease-out,
      border-color 0.2s ease;
  }

  .project-card.visible {
    opacity: 1;
    filter: blur(0px);
    transform: translateY(0) translateZ(0);
  }

  .project-card:hover {
    border-color: var(--card-border-hover-color);
  }

  .project-links :global(svg) {
    font-size: 1.2em;
  }

  .project-body :global(p) {
    margin-bottom: 1em;
  }
  .project-body :global(ul) {
    padding-left: 1.5em;
    margin-top: 0.5em;
    list-style: disc;
  }
</style>
