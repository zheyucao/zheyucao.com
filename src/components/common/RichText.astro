---
/**
 * RichText Component
 *
 * Renders Markdown content with proper styling.
 * Accepts either a single string or an array of strings (paragraphs).
 *
 * Usage:
 *   <RichText content="# Hello\nThis is **bold**" />
 *   <RichText content={["First paragraph", "Second paragraph"]} />
 *   <RichText tag="p" inline content="Inline **bold** text" />
 */

import MarkdownIt from "markdown-it";
import { sanitizeRich } from "../../lib/utils/sanitize";

interface Props {
  content: string | string[];
  class?: string;
  tag?: string;
  inline?: boolean;
}

const { content, class: className = "", tag: Tag = "div", inline = false } = Astro.props;

// Convert array to markdown string with paragraph breaks
let markdownContent = Array.isArray(content) ? content.join("\n\n") : content;

// Convert literal \n to actual newlines (for line breaks within paragraphs)
// This handles cases like "text  \n*italic*" in the data
markdownContent = markdownContent.replace(/\\n/g, "\n");

// Initialize markdown-it with HTML enabled and breaks
const md = new MarkdownIt({
  html: true,
  linkify: true,
  typographer: true,
  breaks: true, // Convert \n to <br>
});

const rawHtml = inline ? md.renderInline(markdownContent) : md.render(markdownContent);
const html = sanitizeRich(rawHtml);

// Create props object for dynamic component
const tagProps = {
  class: `rich-text ${className}`,
};
---

<Tag {...tagProps} set:html={html} />
