---
const { defaultTheme } = Astro.props;
---

<script is:inline>
  // Safari view transitions can flicker; force fallback swap there.
  const ua = navigator.userAgent;
  const isSafari = /Safari\//.test(ua) && !/Chrome\//.test(ua);
  if (isSafari) {
    try {
      // @ts-expect-error Override to disable View Transitions, which have flicker issues in these browsers.
      document.startViewTransition = undefined;
    } catch {
      /* ignore */
    }
  }
</script>

<script is:inline>
  // Apply a class for reduced motion as early as possible and keep it in sync
  const motionQuery = window.matchMedia("(prefers-reduced-motion: reduce)");
  const updateMotionClass = () =>
    document.documentElement.classList.toggle("reduce-motion", motionQuery.matches);
  updateMotionClass();
  motionQuery.addEventListener("change", updateMotionClass);
</script>

<!-- START Insert Theme Detection Script Here -->
<script is:inline define:vars={{ defaultTheme }}>
  // Immediate theme application to prevent flash
  if (defaultTheme === "dark") {
    document.documentElement.classList.add("dark");
  } else if (
    defaultTheme === "system" &&
    window.matchMedia("(prefers-color-scheme: dark)").matches
  ) {
    document.documentElement.classList.add("dark");
  }
</script>
