---
// Content for the "Highlights & Updates" showcase section
import Button from "../../common/Button.astro";
import RichText from "../../common/RichText.astro";
import { formatDateRange, formatDate } from "../../../lib/utils/dateUtils";
import type { CollectionEntry } from "astro:content";
import type { AstroComponentFactory } from "astro/runtime/server/index.js";

interface Props {
  title: string;
  cta?: {
    text: string;
    href: string;
  };
  fallback: string;
  events: Array<CollectionEntry<"timeline"> & { Content: AstroComponentFactory }>;
}

const { title, cta, fallback, events } = Astro.props;
const highlightsToShow = events;
---

<h2 slot="title" class="section-title scroll-target-title">{title}</h2>

<div class="section-content scroll-target-content">
  {
    highlightsToShow.length > 0 ? (
      <ul class="list-none pl-0 mt-0">
        {highlightsToShow.map((event, index) => (
          <li
            class:list={[
              "mb-4 pb-4",
              "sm:flex sm:gap-[1.5rem]",
              index === highlightsToShow.length - 1 && "!mb-0 !pb-0",
            ]}
          >
            <div class="mb-2 sm:mb-0 sm:shrink-0 sm:basis-[80px]">
              <time
                datetime={event.data.endDate ?? event.data.startDate ?? ""}
                class="font-sans text-[0.9rem] leading-[1.6] block"
              >
                {formatDateRange(event.data.startDate, event.data.endDate) ||
                  formatDate(event.data.startDate || event.data.endDate || "")}
              </time>
            </div>
            <div class="flex-1">
              <h4 class="text-[1.2rem] font-normal m-0 mb-2 leading-[1.5]">{event.data.title}</h4>
              {event.data.highlightSummary ? (
                <div class="highlight-summary text-[1rem] text-text leading-[1.7] [&_p]:m-0">
                  <RichText content={event.data.highlightSummary} />
                </div>
              ) : (
                <div class="highlight-description text-[1rem] text-text leading-[1.7] [&_p]:m-0 [&_ul]:pl-[1.2em] [&_ul]:mt-2 [&_ul]:list-disc">
                  <event.Content />
                </div>
              )}
            </div>
          </li>
        ))}
      </ul>
    ) : (
      <p>{fallback}</p>
    )
  }

  {
    cta?.href && cta?.text ? (
      <div class="btn-group">
        <Button class="button" href={cta.href} text={cta.text} wrapperClass="cta-link" />
      </div>
    ) : null
  }
</div>
