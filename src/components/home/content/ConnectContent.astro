---
// Content for the "Keep in touch" section
import Button from "../../common/Button.astro";
import Tooltip from "../../common/Tooltip.astro";
import { Icon } from "astro-icon/components";
import type { AstroComponentFactory } from "astro/runtime/server";

interface Props {
  data: {
    title: string;
    cta: {
      text: string;
      href: string;
    };
    Content: AstroComponentFactory;
    socialItems?: {
      icon: string;
      label?: string;
      href?: string;
      target?: string;
      rel?: string;
      description?: string;
      copyOnClick?: boolean;
    }[];
  };
}

const { data } = Astro.props;
const { title, cta, Content, socialItems } = data;
---

<h2 slot="title" class="about-title scroll-target-title">{title}</h2>

<div class="about-content scroll-target-content">
  <div class="rich-text">
    <Content />
  </div>

  <div class="connect-icon-links">
    {
      socialItems?.length
        ? socialItems.map((item) => {
            const label = item.label || "Link";
            const description = item.description;
            return (
              <Tooltip label={label} position="bottom">
                <div slot="bubble">
                  <div class="tooltip-label">{label}</div>
                  {description && <div class="tooltip-desc">{description}</div>}
                </div>
                {item.href ? (
                  <a
                    href={item.href}
                    target={item.target}
                    rel={item.rel}
                    aria-label={label}
                  >
                    <Icon name={item.icon} size={22} aria-hidden="true" />
                  </a>
                ) : (
                  <span
                    class="icon-placeholder"
                    role="img"
                    aria-label={label}
                    data-copy-value={(item.copyOnClick ?? true) ? label : undefined}
                  >
                    <Icon name={item.icon} size={22} aria-hidden="true" />
                  </span>
                )}
              </Tooltip>
            );
          })
        : null
    }
  </div>

  {/* Button for full contact page */}
  <div class="button-group">
    <Button class="button" href={cta.href} text={cta.text} wrapperClass="cta-link" />
  </div>
</div>

<style>
  p {
    margin-bottom: 1.5rem; /* Space below intro text */
    line-height: 1.7;
    color: var(--theme-text);
  }

  .connect-icon-links {
    display: flex;
    align-items: center;
    gap: 1.8rem; /* Generous spacing between icons */
    margin-bottom: 2.5rem; /* Space below icons */
  }

  .connect-icon-links a,
  .connect-icon-links .icon-placeholder {
    color: var(--theme-icon-color);
    opacity: 0.8;
    transition:
      opacity 0.2s ease,
      color 0.2s ease;
    display: inline-block;
  }

  .connect-icon-links a:hover,
  .connect-icon-links a:focus,
  .connect-icon-links .icon-placeholder:hover,
  .connect-icon-links .icon-placeholder:focus {
    opacity: 1;
    color: var(--theme-accent);
    outline: none;
  }

  .connect-icon-links .icon-placeholder {
    cursor: pointer;
  }

  /* Style for the button group containing the CTA button */
  .button-group {
    display: flex;
    gap: 1rem;
    margin-top: 2rem; /* Adjust spacing above button */
  }

  /* Remove styles specific to the old .cta-link if they exist */
  /* .cta-link { ... } */
</style>

<script>
  const handleCopy = async (value) => {
    try {
      await navigator.clipboard.writeText(value);
    } catch (e) {
      console.error("Unable to copy contact value:", e);
    }
  };

  document.addEventListener("astro:page-load", () => {
    const copyTargets = document.querySelectorAll(".connect-icon-links [data-copy-value]");
    copyTargets.forEach((el) => {
      el.addEventListener("click", (event) => {
        const value = el.getAttribute("data-copy-value");
        if (!value) return;
        event.preventDefault();
        handleCopy(value);
      });
    });
  });
</script>
