---
// Content for the "Highlights & Updates" section
import Button from "../../common/Button.astro";
import RichText from "../../common/RichText.astro";
import { formatTimelineDate } from "../../../lib/utils/dateUtils";

interface Props {
  data: {
    section: {
      title: string;
      cta: {
        text: string;
        href: string;
      };
      fallback: string;
    };
    events: any[];
  };
}

const { data } = Astro.props;
const { section, events } = data;
const { title, cta, fallback } = section;
const highlightsToShow = events;
---

<h2 slot="title" class="about-title scroll-target-title">{title}</h2>

<div class="about-content scroll-target-content">
  {
    highlightsToShow.length > 0 ? (
      <ul class="highlights-list-enhanced">
        {highlightsToShow.map((event) => (
          <li class="highlight-item-enhanced">
            <div class="highlight-meta">
              <time datetime={event.data.date} class="highlight-date">
                {formatTimelineDate(event.data.date)}
              </time>
            </div>
            <div class="highlight-body">
              <h4 class="highlight-title">{event.data.title}</h4>
              {/* Use highlightSummary if available, fallback to description (Content) */}
              {event.data.highlightSummary ? (
                <div class="highlight-summary">
                  <RichText content={event.data.highlightSummary} />
                </div>
              ) : (
                <div class="highlight-description">
                  <event.Content />
                </div>
              )}
            </div>
          </li>
        ))}
      </ul>
    ) : (
      <p>{fallback}</p>
    )
  }

  <div class="button-group">
    <Button class="button" href={cta.href} text={cta.text} wrapperClass="cta-link" />
  </div>
</div>

<style>
  .highlights-list-enhanced {
    list-style: none;
    padding-left: 0;
    margin-top: 0; /* Remove potential default margin */
  }

  .highlight-item-enhanced {
    margin-bottom: 2.5rem;
    padding-bottom: 2.5rem;
    border-bottom: 1px solid var(--theme-divider-color);
  }

  .highlight-item-enhanced:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none;
  }

  .highlight-meta {
    margin-bottom: 0.5rem;
  }

  .highlight-date {
    font-family: var(--font-family-sans);
    font-size: 0.9rem;
    line-height: 1.6;
    display: block;
  }

  .highlight-body p {
    margin: 0;
  }

  .highlight-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin: 0 0 0.5rem 0;
    line-height: 1.5;
  }

  .highlight-summary :global(p),
  .highlight-description :global(p) {
    font-size: 1rem;
    color: var(--theme-text);
    margin: 0;
    line-height: 1.7;
  }

  .highlight-description {
    margin: 0;
  }
  .highlight-description ul {
    padding-left: 1.2em;
    margin-top: 0.5em;
    list-style: disc;
  }
  .button-group {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
  }

  /* --- Responsive layout for wider screens --- */
  @media (min-width: 640px) {
    .highlight-item-enhanced {
      display: flex;
      gap: 1.5rem;
    }

    .highlight-meta {
      flex: 0 0 80px;
      margin-bottom: 0;
    }

    .highlight-body {
      flex: 1 1 auto;
    }
  }
</style>
