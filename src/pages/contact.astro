---
import SubPageLayout from "../layouts/SubPageLayout.astro";
import { getContactViewModel } from "../viewmodels/contactViewModel";
import { Icon } from "astro-icon/components";
import Button from "../components/common/Button.astro";

const { intro, sections, metadata } = await getContactViewModel();
---

<SubPageLayout title={metadata.title}>
  {
    metadata.actions &&
      metadata.actions.map((action) => (
        <Button
          slot="actions"
          href={action.href}
          text={action.text}
          style={action.style}
          download={action.download}
          icon={action.icon}
          iconPosition={action.iconPosition}
          target={action.target}
          rel={action.rel}
          noMargin={true}
          wrapperClass="page-load-initial-state"
        />
      ))
  }
  <div class="max-w-[600px]">
    {
      intro && (
        <div class="mb-4 text-[1.2em] leading-[1.7] text-text-muted">
          <intro.Content />
        </div>
      )
    }

    {
      sections.map((section) => (
        <>
          <div class="section-prose text-[1.2rem] leading-[1.7] mt-12 mb-6">
            <section.Content />
          </div>
          <ul class="list-none pl-0 m-0 leading-[1.9]">
            {section.items.map((item) => (
              <li class="contact-item mb-[1.2rem] flex items-start text-[1.2rem]">
                <Icon
                  name={item.icon}
                  class="contact-icon mr-4 text-[1.3em] shrink-0 opacity-90 mt-[0.3em]"
                />
                {(() => {
                  const value = item.content || "";
                  const description = item.description;
                  const copyValue = undefined;

                  if (item.href) {
                    return (
                      <>
                        <a
                          href={item.href}
                          target={item.target}
                          rel={item.rel}
                          class="contact-link break-all"
                        >
                          {value}
                        </a>
                        {description && <span class="text-text-muted">&nbsp;{description}</span>}
                      </>
                    );
                  }

                  if (copyValue) {
                    return (
                      <>
                        <span class:list={["copyable", { clickable: true }]}>{value}</span>
                        {description && <span class="text-text-muted">&nbsp;{description}</span>}
                      </>
                    );
                  }

                  return (
                    <>
                      <span>{value}</span>
                      {description && <span class="text-text-muted">&nbsp;{description}</span>}
                    </>
                  );
                })()}
              </li>
            ))}
          </ul>
        </>
      ))
    }
  </div>
</SubPageLayout>

<style>
  /* Visual styling - colors only */
  .section-prose {
    color: var(--text-heading-color);
  }

  .contact-icon {
    color: var(--icon-color);
  }

  .contact-link {
    color: var(--link-color);
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .contact-link:hover {
    color: var(--link-hover-color);
    text-decoration: underline;
  }
</style>
