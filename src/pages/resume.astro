---
import SubPageLayout from "../layouts/SubPageLayout.astro";
import ResumeSectionRenderer from "../components/resume/ResumeSectionRenderer.astro";
import Button from "../components/common/Button.astro";
import { getResumeViewModel } from "../viewmodels/resumeViewModel";

const { mainColumn, sidebar, metadata } = await getResumeViewModel();
const { title, actions } = metadata;
---

<SubPageLayout title={title}>
  {
    actions &&
      actions.map((action) => (
        <Button
          slot="actions"
          href={action.href}
          text={action.text}
          style={action.style}
          download={action.download}
          icon={action.icon}
          iconPosition={action.iconPosition}
          target={action.target}
          rel={action.rel}
          noMargin={true}
          wrapperClass="page-load-initial-state"
        />
      ))
  }

  <div class="resume-container">
    <div class="main-column">
      {mainColumn.map((section) => <ResumeSectionRenderer section={section} />)}
    </div>

    <aside class="sidebar">
      {sidebar.map((section) => <ResumeSectionRenderer section={section} />)}
    </aside>
  </div>
</SubPageLayout>

<style>
  .resume-container {
    display: grid;
    grid-template-columns: 1fr 240px;
    gap: 4rem;
    max-width: 1200px;
    margin: 0 auto;
  }

  .main-column {
    min-width: 0; /* Prevent overflow in grid items */
    font-size: 1.2rem;
  }

  .sidebar {
    position: sticky;
    top: 2rem;
    height: fit-content;
    font-size: 1.2rem;
  }

  .download-section {
    margin-bottom: 3rem;
  }

  @media (max-width: 1200px) {
    .resume-container {
      grid-template-columns: 1fr;
      gap: 3rem;
    }

    .sidebar {
      position: static;
    }
  }
</style>
